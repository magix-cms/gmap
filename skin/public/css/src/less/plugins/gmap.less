// Compiler options
@import (reference) "mixins";

// Variables de configuration
@mapH: 600px;
@formH: 50px;
@alertH: 50px;
@transitionSpeed: 0.35s;
@panelWidth: 450px; // Largeur du panneau sur desktop

#gmap {
	.material-icons, .ico {
		vertical-align: middle;
		display: inline-block;
		line-height: 1;
	}
	.map {
		min-height: @mapH;
		position: relative; // Référentiel pour tous les éléments en absolute (panneaux)
		overflow: hidden;
		margin-bottom: 2rem;
		display: block; // Le parent n'a plus besoin d'être flex si le panneau est en absolute

		// Conteneur de la carte (Option 2 avec div fantôme respectée)
		> div:first-child {
			width: 100%;
			height: @mapH;
			display: block;
		}
	}

	.gmap3 {
		height: @mapH;
		width: 100%;
		transition: all @transitionSpeed ease;
		z-index: 1;

		img {
			max-width: inherit;
		}

		// Support pour les nouveaux Advanced Markers
		.google-maps-marker-view {
			transition: transform 0.2s ease-out;
			cursor: pointer;
			overflow: visible !important;
			&:hover {
				transform: scale(1.1);
				z-index: 1000 !important;
			}
		}
	}

	// Styles des labels sur les marqueurs (A, B, etc.)
	.marker-label {
		font-family: Arial, sans-serif;
		font-size: 12px;
		text-shadow: 0 0 2px black;
		color: #fff;
		font-weight: bold;
		pointer-events: none;
	}

	.form-search {
		:is(input, button) {
			border-radius: 0;
			border: none;
		}
		input {
			height: @formH;
			padding: 1rem;
			background: #fff;
		}
		.subdirection {
			.size(52px, @formH);
			border-left: 1px solid #ddd;
		}
		.input-group {
			display: flex;
			width: 100%;
			input.form-control { flex-grow: 2; }
		}
	}
}

// LE PANNEAU FLOTTANT (ADRESSE + RECHERCHE)
#gmap-address {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: 10;
	pointer-events: none;
	display: flex;
	flex-direction: column; // Empile les éléments verticalement
	max-height: @mapH; // Empêche de dépasser de la carte
	transition: transform @transitionSpeed ease;

	@media (min-width: @screen-sm-min) {
		max-width: @panelWidth;
	}

	// ÉTAT FERMÉ : On cache le panneau à gauche (ou en haut sur mobile)
	&:not(.open) {
		@media (max-width: @screen-xs-max) {
			transform: translateY(-100%);
		}
		@media (min-width: @screen-sm-min) {
			transform: translateX(-100%);
		}
	}
	// ÉTAT OUVERT : On le remet à sa position d'origine
	&.open {
		transform: translate(0, 0);
		box-shadow: 5px 0 15px rgba(0,0,0,0.1);
	}

	// Réactiver les clics sur les éléments interactifs
	.alert, .form-search, #r-directions, .hidepanel {
		pointer-events: auto;
	}
	// Le conteneur de recherche et l'alerte restent en haut
	#searchdir, .alert {
		flex-shrink: 0; // Ils ne doivent pas rétrécir
	}

	.alert {
		background-color: var(--main-color);
		color: #f2f2f2;
		margin-bottom: 0;
		border-radius: 0;
		border: none;
		position: relative;

		// FORCE l'alignement vertical du contenu
		display: flex;
		align-items: center;
		justify-content: space-between;
		min-height: @alertH;
		padding: 0.5rem 1rem;
		& {
			box-shadow: 0 2px 5px rgba(0,0,0,0.1); // Donne un peu de relief constant
		}
		// On neutralise les anciens styles qui pourraient décaler le bouton
		.btn:not(.hidepanel) {
			position: relative; // On enlève l'absolute s'il y en avait un
			top: auto;
			right: auto;
			transform: none;
			margin-left: 10px; // Espace avec le texte de l'adresse
			order: 2; // Force le bouton à être à droite dans le flex
		}

		#address {
			flex: 1;
			order: 1;
		}
	}

	// LE PANNEAU D'ITINÉRAIRE (S'affiche par-dessus la carte)
	#r-directions {
		position: relative; // On passe de absolute à relative
		width: 100%;
		background: #fff;
		z-index: 5;
		overflow-y: auto;

		// Animation de glissement (on utilise max-height pour l'effet de dépliage)
		max-height: 0;
		opacity: 0;
		transition: max-height @transitionSpeed ease, opacity @transitionSpeed ease;
		border-bottom: 0 solid #ddd;

		&.sizedirection {
			max-height: (@mapH - @formH - @alertH); // Prend la place restante
			opacity: 1;
			border-bottom-width: 2px;
			box-shadow: 0 5px 15px rgba(0,0,0,0.1);
		}

		.adp {
			padding: 1rem;
			&::-webkit-scrollbar { width: 6px; }
			&::-webkit-scrollbar-thumb { background: #ccc; }
		}
	}

	.hidepanel {
		position: absolute;
		background: #fff;
		border: 1px solid #ddd;
		color: @text-color;
		cursor: pointer;
		z-index: 15; // S'assure qu'il est au-dessus du reste

		@media (max-width: @screen-xs-max) {
			right: 50%;
			bottom: 0;
			transform: translate(50%, 100%);
			padding: 10px 20px;
			.hor { display: none; }
		}

		@media (min-width: @screen-sm-min) {
			right: 0;
			top: (@alertH / 2); // On le place au milieu théorique de l'alerte
			transform: translate(100%, -50%); // On le décale de sa propre moitié vers le haut pour un centrage parfait

			padding: 14px 10px;
			.ver { display: none; }
		}
		&::after {
			content: '';//'‹';
			display: inline-block;
			transition: transform @transitionSpeed; // La flèche tourne aussi !
		}

		&:not(.open)::after {
			transform: rotate(180deg); // La flèche pointe vers la droite quand c'est fermé
		}

		&.open { .show-more { display: none; } }
		&:not(.open) { .show-less { display: none; } }
	}
}

// LISTE DES ADRESSES SOUS LA CARTE
#addresses {
	margin-top: 2rem;
	h3 { color: var(--main-color); font-weight: bold; }
	.row > div { padding-bottom: 30px; }
	.img-responsive { max-width: 100%; height: auto; }
}

// GESTION DU BOUTON FORMULAIRE (OPEN/CLOSE)
#showform {
	&.open { .open { display: none; } }
	&:not(.open) { .close { display: none; } }
}